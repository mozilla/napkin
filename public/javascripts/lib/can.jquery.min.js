(function(can,window,undefined){$.extend(can,jQuery,{trigger:function(e,t,n){e.trigger?e.trigger(t,n):$.event.trigger(t,n,e,!0)},addEvent:function(e,t){return $([this]).bind(e,t),this},removeEvent:function(e,t){return $([this]).unbind(e,t),this},buildFragment:function(e,t){var n=$.buildFragment([e],[t]);return n.cacheable?$.clone(n.fragment):n.fragment},$:jQuery}),$.each(["bind","unbind","undelegate","delegate"],function(e,t){can[t]=function(){var e=this[t]?this:$([this]);return e[t].apply(e,arguments),this}}),$.each(["append","filter","addClass","remove","data","get"],function(e,t){can[t]=function(e){return e[t].apply(e,can.makeArray(arguments).slice(1))}});var oldClean=$.cleanData;$.cleanData=function(e){$.each(e,function(e,t){can.trigger(t,"destroyed",[],!1)}),oldClean(e)},can.each=function(e,t,n){var r=0,i;if(e)if(typeof e.length=="number"&&e.pop){e.attr&&e.attr("length");for(var s=e.length;r<s;r++)if(t.call(n||e[r],e[r],r,e)===!1)break}else for(i in e)if(t.call(n||e[r],e[i],i,e)===!1)break;return e};var undHash=/_|-/,colons=/==/,words=/([A-Z]+)([A-Z][a-z])/g,lowUp=/([a-z\d])([A-Z])/g,dash=/([a-z\d])([A-Z])/g,replacer=/\{([^\}]+)\}/g,quote=/"/g,singleQuote=/'/g,getNext=function(e,t,n){return t in e?e[t]:n&&(e[t]={})},isContainer=function(e){return/^f|^o/.test(typeof e)};can.extend(can,{esc:function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(quote,"&#34;").replace(singleQuote,"&#39;")},getObject:function(e,t,n){var r=e?e.split("."):[],i=r.length,s,o=0,u,a;t=can.isArray(t)?t:[t||window];if(!i)return t[0];while(s=t[o++]){for(a=0;a<i-1&&isContainer(s);a++)s=getNext(s,r[a],n);if(isContainer(s)){u=getNext(s,r[a],n);if(u!==undefined)return n===!1&&delete s[r[a]],u}}},capitalize:function(e,t){return e.charAt(0).toUpperCase()+e.slice(1)},underscore:function(e){return e.replace(colons,"/").replace(words,"$1_$2").replace(lowUp,"$1_$2").replace(dash,"_").toLowerCase()},sub:function(e,t,n){var r=[];return r.push(e.replace(replacer,function(e,i){var s=can.getObject(i,t,n===undefined?n:!n);return isContainer(s)?(r.push(s),""):""+s})),r.length<=1?r[0]:r},replacer:replacer,undHash:undHash});var initializing=0;can.Construct=function(){if(arguments.length)return can.Construct.extend.apply(can.Construct,arguments)},can.extend(can.Construct,{newInstance:function(){var e=this.instance(),t=arguments,n;return e.setup&&(n=e.setup.apply(e,arguments)),e.init&&e.init.apply(e,n||arguments),e},_inherit:function(e,t,n){can.extend(n||e,e||{})},_overwrite:function(e,t,n,r){e[n]=r},setup:function(e,t){this.defaults=can.extend(!0,{},e.defaults,this.defaults)},instance:function(){initializing=1;var e=new this;return initializing=0,e},extend:function(e,t,n){function f(){if(!initializing)return this.constructor!==f&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.constructor.newInstance.apply(this.constructor,arguments)}typeof e!="string"&&(n=t,t=e,e=null),n||(n=t,t=null),n=n||{};var r=this,i=this.prototype,s,o,u,a;a=this.instance(),can.Construct._inherit(n,i,a);for(s in r)r.hasOwnProperty(s)&&(f[s]=r[s]);can.Construct._inherit(t,r,f);if(e){var l=e.split("."),o=l.pop(),c=can.getObject(l.join("."),window,!0),u=c,h=can.underscore(e.replace(/\./g,"_")),p=can.underscore(o);c[o],c[o]=f}can.extend(f,{constructor:f,prototype:a,namespace:u,shortName:o,_shortName:p,fullName:e,_fullName:h}),f.prototype.constructor=f;var d=[r].concat(can.makeArray(arguments)),v=f.setup.apply(f,d);return f.init&&f.init.apply(f,v||d),f}});var canMakeObserve=function(e){return e&&typeof e=="object"&&!(e instanceof Date)},unhookup=function(e,t){return can.each(e,function(e){e&&e.unbind&&e.unbind("change"+t)})},hookupBubble=function(e,t,n){return e instanceof Observe?unhookup([e],n._namespace):can.isArray(e)?e=new Observe.List(e):e=new Observe(e),e.bind("change"+n._namespace,function(r,i){var s=can.makeArray(arguments),r=s.shift();s[0]=t==="*"?n.indexOf(e)+"."+s[0]:t+"."+s[0],r.triggeredNS=r.triggeredNS||{};if(r.triggeredNS[n._namespace])return;r.triggeredNS[n._namespace]=!0,can.trigger(n,r,s),can.trigger(n,s[0],s)}),e},observeId=0,collecting=undefined,collect=function(){if(!collecting)return collecting=[],!0},batchTrigger=function(e,t,n){if(!e._init){if(!collecting)return can.trigger(e,t,n);collecting.push([e,{type:t,batchNum:batchNum},n])}},batchNum=1,sendCollection=function(){var e=collecting.slice(0);collecting=undefined,batchNum++,can.each(e,function(e){can.trigger.apply(can,e)})},serialize=function(e,t,n){return e.each(function(e,r){n[r]=canMakeObserve(e)&&can.isFunction(e[t])?e[t]():e}),n},$method=function(e){return function(){return can[e].apply(this,arguments)}},bind=$method("addEvent"),unbind=$method("removeEvent"),attrParts=function(e){return can.isArray(e)?e:(""+e).split(".")},Observe=can.Construct("can.Observe",{setup:function(){can.Construct.setup.apply(this,arguments)},bind:bind,unbind:unbind,id:"id"},{setup:function(e){this._data={},this._namespace=".observe"+ ++observeId,this._init=1,this.attr(e),delete this._init},attr:function(e,t){return~"ns".indexOf((typeof e).charAt(0))?t===undefined?(Observe.__reading&&Observe.__reading(this,e),this._get(e)):(this._set(e,t),this):this._attrs(e,t)},each:function(){return can.each.apply(undefined,[this.__get()].concat(can.makeArray(arguments)))},removeAttr:function(e){var t=attrParts(e),n=t.shift(),r=this._data[n];return t.length?r.removeAttr(t):(delete this._data[n],n in this.constructor.prototype||delete this[n],batchTrigger(this,"change",[n,"remove",undefined,r]),batchTrigger(this,n,[undefined,r]),r)},_get:function(e){var t=attrParts(e),n=this.__get(t.shift());return t.length?n?n._get(t):undefined:n},__get:function(e){return e?this._data[e]:this._data},_set:function(e,t){var n=attrParts(e),r=n.shift(),i=this.__get(r);if(canMakeObserve(i)&&n.length)i._set(n,t);else{if(!!n.length)throw"can.Observe: Object does not exist";this.__convert&&(t=this.__convert(r,t)),this.__set(r,t,i)}},__set:function(e,t,n){if(t!==n){var r=this.__get().hasOwnProperty(e)?"set":"add";this.___set(e,canMakeObserve(t)?hookupBubble(t,e,this):t),batchTrigger(this,"change",[e,r,t,n]),batchTrigger(this,e,[t,n]),n&&unhookup([n],this._namespace)}},___set:function(e,t){this._data[e]=t,e in this.constructor.prototype||(this[e]=t)},bind:bind,unbind:unbind,serialize:function(){return serialize(this,"serialize",{})},_attrs:function(e,t){if(e===undefined)return serialize(this,"attr",{});e=can.extend(!0,{},e);var n,r=collect(),i=this,s;this.each(function(n,r){s=e[r];if(s===undefined){t&&i.removeAttr(r);return}canMakeObserve(n)&&canMakeObserve(s)?n.attr(s,t):n!=s&&i._set(r,s),delete e[r]});for(var n in e)s=e[n],this._set(n,s);return r&&sendCollection(),this}}),splice=[].splice,list=Observe("can.Observe.List",{setup:function(e,t){this.length=0,this._namespace=".observe"+ ++observeId,this._init=1,this.bind("change",can.proxy(this._changes,this)),this.push.apply(this,can.makeArray(e||[])),can.extend(this,t),delete this._init},_changes:function(e,t,n,r,i){~t.indexOf(".")||(n==="add"?(batchTrigger(this,n,[r,+t]),batchTrigger(this,"length",[this.length])):n==="remove"?(batchTrigger(this,n,[i,+t]),batchTrigger(this,"length",[this.length])):batchTrigger(this,n,[r,+t]))},__get:function(e){return e?this[e]:this},___set:function(e,t){this[e]=t,+e>=this.length&&(this.length=+e+1)},serialize:function(){return serialize(this,"serialize",[])},splice:function(e,t){var n=can.makeArray(arguments),r;for(r=2;r<n.length;r++){var i=n[r];canMakeObserve(i)&&(n[r]=hookupBubble(i,"*",this))}t===undefined&&(t=n[1]=this.length-e);var s=splice.apply(this,n);return t>0&&(batchTrigger(this,"change",[""+e,"remove",undefined,s]),unhookup(s,this._namespace)),n.length>2&&batchTrigger(this,"change",[""+e,"add",n.slice(2),s]),s},_attrs:function(e,t){if(e===undefined)return serialize(this,"attr",[]);e=e.slice(0);var n=Math.min(e.length,this.length),r=collect(),i;for(var i=0;i<n;i++){var s=this[i],o=e[i];canMakeObserve(s)&&canMakeObserve(o)?s.attr(o,t):s!=o&&this._set(i,o)}e.length>this.length?this.push(e.slice(this.length)):e.length<this.length&&t&&this.splice(e.length),r&&sendCollection()}}),getArgs=function(e){return e[0]&&can.isArray(e[0])?e[0]:can.makeArray(e)};can.each({push:"length",unshift:0},function(e,t){list.prototype[t]=function(){var n=getArgs(arguments),r=e?this.length:0;for(var i=0;i<n.length;i++){var s=n[i];canMakeObserve(s)&&(n[i]=hookupBubble(s,"*",this))}var o=[][t].apply(this,n);return(!this.comparator||!n.length)&&batchTrigger(this,"change",[""+r,"add",n,undefined]),o}}),can.each({pop:"length",shift:0},function(e,t){list.prototype[t]=function(){var n=getArgs(arguments),r=e&&this.length?this.length-1:0,i=[][t].apply(this,n);return batchTrigger(this,"change",[""+r,"remove",undefined,[i]]),i&&i.unbind&&i.unbind("change"+this._namespace),i}}),list.prototype.indexOf=[].indexOf||function(e){return can.inArray(e,this)};var pipe=function(e,t,n){var r=new can.Deferred;return e.then(function(){arguments[0]=t[n](arguments[0]),r.resolve.apply(r,arguments)},function(){r.rejectWith.apply(this,arguments)}),r},modelNum=0,ignoreHookup=/change.observe\d+/,getId=function(e){return e[e.constructor.id]},ajax=function(e,t,n,r,i,s){if(typeof e=="string"){var o=e.split(" ");e={url:o.pop()},o.length&&(e.type=o.pop())}return e.data=typeof t=="object"&&!can.isArray(t)?can.extend(e.data||{},t):t,e.url=can.sub(e.url,e.data,!0),can.ajax(can.extend({type:n||"post",dataType:r||"json",success:i,error:s},e))},makeRequest=function(e,t,n,r,i){var s,o=[e.serialize()],u=e.constructor,a;return t!=="create"&&o.unshift(getId(e)),a=u[t].apply(u,o),s=a.pipe(function(n){return e[i||t+"d"](n,a),e}),a.abort&&(s.abort=function(){a.abort()}),s.then(n,r)},ajaxMethods={create:{url:"_shortName",type:"post"},update:{data:function(e,t){t=t||{};var n=this.id;return t[n]&&t[n]!==e&&(t["new"+can.capitalize(e)]=t[n],delete t[n]),t[n]=e,t},type:"put"},destroy:{type:"delete",data:function(e,t){return t=t||{},t[this.id]=e,t}},findAll:{url:"_shortName"},findOne:{}},ajaxMaker=function(e,t){return function(n){return n=e.data?e.data.apply(this,arguments):n,ajax(t||this[e.url||"_url"],n,e.type||"get")}};can.Observe("can.Model",{setup:function(e){can.Observe.apply(this,arguments);if(this===can.Model)return;var t=this,n=can.proxy(this._clean,t);can.each(ajaxMethods,function(r,i){can.isFunction(t[i])||(t[i]=ajaxMaker(r,t[i]));if(t["make"+can.capitalize(i)]){var s=t["make"+can.capitalize(i)](t[i]);can.Construct._overwrite(t,e,i,function(){return this._super,this._reqs++,s.apply(this,arguments).then(n,n)})}});if(!t.fullName||t.fullName==e.fullName)t.fullName=t._shortName="Model"+ ++modelNum;this.store={},this._reqs=0,this._url=this._shortName+"/{"+this.id+"}"},_ajax:ajaxMaker,_clean:function(){this._reqs--;if(!this._reqs)for(var e in this.store)this.store[e]._bindings||delete this.store[e]},models:function(e){if(!e)return;if(e instanceof this.List)return e;var t=this,n=new(t.List||ML),r=can.isArray(e),i=e instanceof ML,s=r?e:i?e.serialize():e.data,o=0;return can.each(s,function(e){n.push(t.model(e))}),r||can.each(e,function(e,t){t!=="data"&&(n[t]=e)}),n},model:function(e){if(!e)return;e instanceof this&&(e=e.serialize());var t=this.store[e[this.id]]?this.store[e[this.id]].attr(e):new this(e);return this._reqs&&(this.store[e[this.id]]=t),t}},{isNew:function(){var e=getId(this);return!e&&e!==0},save:function(e,t){return makeRequest(this,this.isNew()?"create":"update",e,t)},destroy:function(e,t){return makeRequest(this,"destroy",e,t,"destroyed")},bind:function(e){return ignoreHookup.test(e)||(this._bindings||(this.constructor.store[getId(this)]=this,this._bindings=0),this._bindings++),can.Observe.prototype.bind.apply(this,arguments)},unbind:function(e){return ignoreHookup.test(e)||(this._bindings--,this._bindings||delete this.constructor.store[getId(this)]),can.Observe.prototype.unbind.apply(this,arguments)},___set:function(e,t){can.Observe.prototype.___set.call(this,e,t),e===this.constructor.id&&this._bindings&&(this.constructor.store[getId(this)]=this)}}),can.each({makeFindAll:"models",makeFindOne:"model"},function(e,t){can.Model[t]=function(t){return function(n,r,i){return pipe(t.call(this,n),this,e).then(r,i)}}}),can.each(["created","updated","destroyed"],function(e){can.Model.prototype[e]=function(t){var n,r=this.constructor;n=t&&typeof t=="object"&&this.attr(t.attr?t.attr():t),can.trigger(this,e),can.trigger(this,"change",e),can.trigger(r,e,this)}});var ML=can.Observe.List("can.Model.List",{setup:function(){can.Observe.List.prototype.setup.apply(this,arguments);var e=this;this.bind("change",function(t,n){/\w+\.destroyed/.test(n)&&e.splice(e.indexOf(t.target),1)})}}),digitTest=/^\d+$/,keyBreaker=/([^\[\]]+)|(\[\])/g,paramTest=/([^?#]*)(#.*)?$/,prep=function(e){return decodeURIComponent(e.replace(/\+/g," "))};can.extend(can,{deparam:function(e){var t={},n,r;return e&&paramTest.test(e)&&(n=e.split("&"),can.each(n,function(e){var n=e.split("="),i=prep(n.shift()),s=prep(n.join("="));current=t,n=i.match(keyBreaker);for(var o=0,u=n.length-1;o<u;o++)current[n[o]]||(current[n[o]]=digitTest.test(n[o+1])||n[o+1]=="[]"?[]:{}),current=current[n[o]];r=n.pop(),r=="[]"?current.push(s):current[r]=s})),t}});var matcher=/\:([\w\.]+)/g,paramsMatcher=/^(?:&[^=]+=[^&]*)+/,makeProps=function(e){var t=[];return can.each(e,function(e,n){t.push((n==="className"?"class":n)+'="'+(n==="href"?e:can.esc(e))+'"')}),t.join(" ")},matchesData=function(e,t){var n=0,r=0,i={};for(var s in e.defaults)e.defaults[s]===t[s]&&(i[s]=1,n++);for(;r<e.names.length;r++){if(!t.hasOwnProperty(e.names[r]))return-1;i[e.names[r]]||n++}return n},onready=!0,location=window.location,each=can.each,extend=can.extend;can.route=function(e,t){t=t||{};var n=[],r=e.replace(matcher,function(r,i,s){n.push(i);var o="\\"+(e.substr(s+r.length,1)||"&");return"([^"+o+"]"+(t[i]?"*":"+")+")"});return can.route.routes[e]={test:new RegExp("^"+r+"($|&)"),route:e,names:n,defaults:t,length:e.split("/").length},can.route},extend(can.route,{param:function(e,t){var n,r=0,i,s=e.route,o=0;delete e.route,each(e,function(){o++}),each(can.route.routes,function(t,s){i=matchesData(t,e),i>r&&(n=t,r=i);if(i>=o)return!1}),can.route.routes[s]&&matchesData(can.route.routes[s],e)===r&&(n=can.route.routes[s]);if(n){var u=extend({},e),a=n.route.replace(matcher,function(t,r){return delete u[r],e[r]===n.defaults[r]?"":encodeURIComponent(e[r])}),f;return each(n.defaults,function(e,t){u[t]===e&&delete u[t]}),f=can.param(u),t&&can.route.attr("route",n.route),a+(f?"&"+f:"")}return can.isEmptyObject(e)?"":"&"+can.param(e)},deparam:function(e){var t={length:-1};each(can.route.routes,function(n,r){n.test.test(e)&&n.length>t.length&&(t=n)});if(t.length>-1){var n=e.match(t.test),r=n.shift(),i=e.substr(r.length-(n[n.length-1]==="&"?1:0)),s=i&&paramsMatcher.test(i)?can.deparam(i.slice(1)):{};return s=extend(!0,{},t.defaults,s),each(n,function(e,n){e&&e!=="&"&&(s[t.names[n]]=decodeURIComponent(e))}),s.route=t.route,s}return e.charAt(0)!=="&"&&(e="&"+e),paramsMatcher.test(e)?can.deparam(e.slice(1)):{}},data:new can.Observe({}),routes:{},ready:function(e){return e===!1&&(onready=e),(e===!0||onready===!0)&&setState(),can.route},url:function(e,t){return t&&(e=extend({},curParams,e)),"#!"+can.route.param(e)},link:function(e,t,n,r){return"<a "+makeProps(extend({href:can.route.url(t,r)},n))+">"+e+"</a>"},current:function(e){return location.hash=="#!"+can.route.param(e)}}),each(["bind","unbind","delegate","undelegate","attr","removeAttr"],function(e){can.route[e]=function(){return can.route.data[e].apply(can.route.data,arguments)}});var timer,curParams,setState=function(){var e=location.href.split(/#!?/)[1]||"";curParams=can.route.deparam(e),(!changingData||e!==lastHash)&&can.route.attr(curParams,!0)},lastHash,changingData;can.bind.call(window,"hashchange",setState),can.route.bind("change",function(e,t){changingData=1,clearTimeout(timer),timer=setTimeout(function(){changingData=0;var e=can.route.data.serialize();location.hash="#!"+(lastHash=can.route.param(e,!0))},1)}),can.bind.call(document,"ready",can.route.ready),function(){var e=function(e,t,n){return can.bind.call(e,t,n),function(){can.unbind.call(e,t,n)}},t=can.isFunction,n=can.extend,r=can.each,i=[].slice,s=/\{([^\}]+)\}/g,o=can.getObject("$.event.special")||{},u=function(e,t,n,r){return can.delegate.call(e,t,n,r),function(){can.undelegate.call(e,t,n,r)}},a=function(t,n,r,i){return i?u(t,can.trim(i),n,r):e(t,n,r)},f=function(n,r){var s=typeof r=="string"?n[r]:r;return t(s)||(s=n[s]),function(){return n.called=r,s.apply(n,[this.nodeName?can.$(this):this].concat(i.call(arguments,0)))}},l;can.Construct("can.Control",{setup:function(){can.Construct.setup.apply(this,arguments);if(this!==can.Control){var e=this,t;e.actions={};for(t in e.prototype)e._isAction(t)&&(e.actions[t]=e._action(t))}},_isAction:function(e){var n=this.prototype[e],r=typeof n;return e!=="constructor"&&(r=="function"||r=="string"&&t(this.prototype[n]))&&!!(o[e]||c[e]||/[^\w]/.test(e))},_action:function(e,t){s.lastIndex=0;if(t||!s.test(e)){var n=t?can.sub(e,[t,window]):e,r=can.isArray(n),i=(r?n[1]:n).match(/^(?:(.*?)\s)?([\w\.\:>]+)$/),o=i[2],u=c[o]||l;return{processor:u,parts:i,delegate:r?n[0]:undefined}}},processors:{},defaults:{}},{setup:function(e,t){var r=this.constructor,i=r.pluginName||r._fullName,s;return this.element=can.$(e),i&&i!=="can_control"&&this.element.addClass(i),(s=can.data(this.element,"controls"))||can.data(this.element,"controls",s=[]),s.push(this),this.options=n({},r.defaults,t),this.on(),[this.element,this.options]},on:function(e,t,n,r){if(!e){this.off();var i=this.constructor,s=this._bindings,o=i.actions,u=this.element,l=f(this,"destroy"),c,h;for(c in o)o.hasOwnProperty(c)&&(h=o[c]||i._action(c,this.options),s.push(h.processor(h.delegate||u,h.parts[2],h.parts[1],c,this)));return can.bind.call(u,"destroyed",l),s.push(function(e){can.unbind.call(e,"destroyed",l)}),s.length}return typeof e=="string"&&(r=n,n=t,t=e,e=this.element),typeof r=="string"&&(r=f(this,r)),this._bindings.push(a(e,n,r,t)),this._bindings.length},off:function(){var e=this.element[0];r(this._bindings||[],function(t){t(e)}),this._bindings=[]},destroy:function(){var e=this.constructor,t=e.pluginName||e._fullName,n;this.off(),t&&t!=="can_control"&&this.element.removeClass(t),n=can.data(this.element,"controls"),n.splice(can.inArray(this,n),1),can.trigger(this,"destroyed"),this.element=null}});var c=can.Control.processors,l=function(e,t,n,r,i){return a(e,t,f(i,r),n)};r(["change","click","contextmenu","dblclick","keydown","keyup","keypress","mousedown","mousemove","mouseout","mouseover","mouseup","reset","resize","scroll","select","submit","focusin","focusout","mouseenter","mouseleave"],function(e){c[e]=l})}(),can.Control.processors.route=function(e,t,n,r,i){can.route(n||"");var s,o=function(e,t,o){if(can.route.attr("route")===(n||"")&&(e.batchNum===undefined||e.batchNum!==s)){s=e.batchNum;var u=can.route.attr();delete u.route,can.isFunction(i[r])?i[r](u):i[i[r]](u)}};return can.route.bind("change",o),function(){can.route.unbind("change",o)}};var isFunction=can.isFunction,makeArray=can.makeArray,hookupId=1,$view=can.view=function(e,t,n,r){var i=$view.render(e,t,n,r);return can.isDeferred(i)?i.pipe(function(e){return $view.frag(e)}):$view.frag(i)};can.extend($view,{frag:function(e,t){return $view.hookup($view.fragment(e),t)},fragment:function(e){var t=can.buildFragment(e,document.body);return t.childNodes.length||t.appendChild(document.createTextNode("")),t},toId:function(e){return can.map(e.toString().split(/\/|\./g),function(e){if(e)return e}).join("_")},hookup:function(e,t){var n=[],r,i,s,o=0;can.each(e.childNodes?can.makeArray(e.childNodes):e,function(e){e.nodeType===1&&(n.push(e),n.push.apply(n,can.makeArray(e.getElementsByTagName("*"))))});for(;s=n[o++];)s.getAttribute&&(r=s.getAttribute("data-view-id"))&&(i=$view.hookups[r])&&(i(s,t,r),delete $view.hookups[r],s.removeAttribute("data-view-id"));return e},hookups:{},hook:function(e){return $view.hookups[++hookupId]=e," data-view-id='"+hookupId+"'"},cached:{},cache:!0,register:function(e){this.types["."+e.suffix]=e},types:{},ext:".ejs",registerScript:function(){},preload:function(){},render:function(e,t,n,r){isFunction(n)&&(r=n,n=undefined);var i=getDeferreds(t);if(i.length){var s=new can.Deferred;return i.push(get(e,!0)),can.when.apply(can,i).then(function(e){var i=makeArray(arguments),o=i.pop(),u;if(can.isDeferred(t))t=usefulPart(e);else for(var a in t)can.isDeferred(t[a])&&(t[a]=usefulPart(i.shift()));u=o(t,n),s.resolve(u),r&&r(u)}),s}var o,u=isFunction(r),s=get(e,u);return u?(o=s,s.then(function(e){r(e(t,n))})):s.then(function(e){o=e(t,n)}),o}}),can.isDeferred=function(e){return e&&isFunction(e.then)&&isFunction(e.pipe)};var checkText=function(e,t){if(!e.length)throw"can.view: No template or empty template:"+t},get=function(e,t){var n=e.match(/\.[\w\d]+$/),r,i,s,o,u=function(e){var t=r.renderer(s,e),n=new can.Deferred;return n.resolve(t),$view.cache&&($view.cached[s]=n),n};e.match(/^#/)&&(e=e.substr(1));if(i=document.getElementById(e))n="."+i.type.match(/\/(x\-)?(.+)/)[2];!n&&!$view.cached[e]&&(e+=n=$view.ext),can.isArray(n)&&(n=n[0]),s=can.view.toId(e);if(e.match(/^\/\//)){var a=e.substr(2);e=window.steal?steal.root.mapJoin(a):"/"+a}r=$view.types[n];if($view.cached[s])return $view.cached[s];if(i)return u(i.innerHTML);var f=new can.Deferred;return can.ajax({async:t,url:e,dataType:"text",error:function(t){checkText("",e),f.reject(t)},success:function(t){checkText(t,e),f.resolve(r.renderer(s,t)),$view.cache&&($view.cached[s]=f)}}),f},getDeferreds=function(e){var t=[];if(can.isDeferred(e))return[e];for(var n in e)can.isDeferred(e[n])&&t.push(e[n]);return t},usefulPart=function(e){return can.isArray(e)&&e[1]==="success"?e[0]:e};window.steal&&steal.type("view js",function(e,t,n){var r=can.view.types["."+e.type],i=can.view.toId(e.rootSrc);e.text="steal('"+(r.plugin||"can/view/"+e.type)+"').then(function($){"+"can.view.preload('"+i+"',"+e.text+");\n})",t()}),can.extend(can.view,{register:function(e){this.types["."+e.suffix]=e,window.steal&&steal.type(e.suffix+" view js",function(e,t,n){var r=can.view.types["."+e.type],i=can.view.toId(e.rootSrc+"");e.text=r.script(i,e.text),t()}),can.view[e.suffix]=function(t,n){$view.preload(t,e.renderer(t,n))}},registerScript:function(e,t,n){return"can.view.preload('"+t+"',"+$view.types["."+e].script(t,n)+");"},preload:function(e,t){can.view.cached[e]=(new can.Deferred).resolve(function(e,n){return t.call(e,e,n)})}});var getValueAndObserved=function(e,t){var n;can.Observe&&(n=can.Observe.__reading,can.Observe.__reading=function(e,t){r.push({obj:e,attr:t})});var r=[],i=e.call(t);return can.Observe&&(can.Observe.__reading=n),{value:i,observed:r}},computeBinder=function(e,t,n){var r={},i=!0,s={value:undefined,teardown:function(){for(var e in r){var t=r[e];t.observe.obj.unbind(t.observe.attr,o),delete r[e]}}},o=function(){var e=s.value,t=u();s.value=t,t!==e&&n(t,e)},u=function(){var n=getValueAndObserved(e,t),s=n.observed,u=n.value;i=!i,can.each(s,function(e){r[e.obj._namespace+"|"+e.attr]?r[e.obj._namespace+"|"+e.attr].matched=i:(r[e.obj._namespace+"|"+e.attr]={matched:i,observe:e},e.obj.bind(e.attr,o))});for(var a in r){var f=r[a];f.matched!==i&&(f.observe.obj.unbind(f.observe.attr,o),delete r[a])}return u};return s.value=u(),s.isListening=!can.isEmptyObject(r),s};can.compute=function(e,t){if(e.isComputed)return e;var n,r=0,i,s=!0;return typeof e=="function"?i=function(r){return r===undefined?n?n.value:e.call(t||this):e.apply(t||this,arguments)}:(i=function(t){if(t===undefined)return e;var n=e;return e=t,n!==t&&can.trigger(i,"change",[t,n]),t},s=!1),i.isComputed=!0,i.bind=function(o,u){can.addEvent.apply(i,arguments),r===0&&s&&(n=computeBinder(e,t||this,function(e,t){can.trigger(i,"change",[e,t])})),r++},i.unbind=function(e,t){can.removeEvent.apply(i,arguments),r--,r===0&&s&&n.teardown()},i},can.compute.binder=computeBinder;var myEval=function(script){eval(script)},extend=can.extend,quickFunc=/\s*\(([\$\w]+)\)\s*->([^\n]*)/,attrReg=/([^\s]+)=$/,newLine=/(\r|\n)+/g,attributeReplace=/__!!__/g,tagMap={"":"span",table:"tr",tr:"td",ol:"li",ul:"li",tbody:"tr",thead:"tr",tfoot:"tr"},clean=function(e){return e.split("\\").join("\\\\").split("\n").join("\\n").split('"').join('\\"').split("	").join("\\t")},bracketNum=function(e){return--e.split("{").length- --e.split("}").length},attrMap={"class":"className"},bool=can.each(["checked","disabled","readonly","required"],function(e){attrMap[e]=e}),setAttr=function(e,t,n){attrMap[t]?e[attrMap[t]]=can.inArray(t,bool)>-1?!0:n:e.setAttribute(t,n)},getAttr=function(e,t){return attrMap[t]?e[attrMap[t]]:e.getAttribute(t)},removeAttr=function(e,t){can.inArray(t,bool)>-1?e[t]=!1:e.removeAttribute(t)},getParentNode=function(e,t){return t&&e.parentNode.nodeType===11?t:e.parentNode},observeProp=function(e){return e.indexOf("|")>=0},contentEscape=function(e){return typeof e=="string"||typeof e=="number"?can.esc(e):contentText(e)},contentText=function(e){if(typeof e=="string")return e;if(!e&&e!=0)return"";var t=e.hookup&&function(t,n){e.hookup.call(e,t,n)}||typeof e=="function"&&e;return t?(pendingHookups.push(t),""):""+e},EJS=function(e){if(this.constructor!=EJS){var t=new EJS(e);return function(e,n){return t.render(e,n)}}if(typeof e=="function"){this.template={fn:e};return}extend(this,e),this.template=scan(this.text,this.name)};can.EJS=EJS,EJS.prototype.render=function(e,t){return e=e||{},this.template.fn.call(e,e,new EJS.Helpers(e,t||{}))},extend(EJS,{txt:function(e,t,n,r,i){var s=can.compute.binder(i,r,function(e,t){l(e,t)});if(!s.isListening)return(e||n!==0?contentEscape:contentText)(s.value);var o,u=function(e){can.bind.call(e,"destroyed",s.teardown),o=e},a=function(e){e||(s.teardown(),can.unbind.call(o,"destroyed",s.teardown))},f=tagMap[t]||"span",l;if(n==0)return"<"+f+can.view.hook(e?function(e,t){l=function(e){r.nodeValue=""+e,a(r.parentNode)};var n=getParentNode(e,t),r=document.createTextNode(s.value);n.insertBefore(r,e),n.removeChild(e),u(n)}:function(e,t){l=function(e){var t=r[0].parentNode;t&&(r=n(e,r)),a(r[0].parentNode)},t=getParentNode(e,t);var n=function(e,n){var r=can.view.frag(e,t),i=can.map(r.childNodes,function(e){return e}),s=n[n.length-1];return s.nextSibling?s.parentNode.insertBefore(r,s.nextSibling):s.parentNode.appendChild(r),can.remove(can.$(n)),i},r=n(s.value,[e]);u(t)})+"></"+f+">";if(n===1){var c=s.value.replace(/['"]/g,"").split("=")[0];return pendingHookups.push(function(e){l=function(t){var n=(t||"").replace(/['"]/g,"").split("="),r=n[0];r!=c&&c&&removeAttr(e,c),r&&(setAttr(e,r,n[1]),c=r)},u(e)}),s.value}return pendingHookups.push(function(e){l=function(){setAttr(e,n,a.render())};var t=can.$(e),r;(r=can.data(t,"hooks"))||can.data(t,"hooks",r={});var i=getAttr(e,n),o=i.split("__!!__"),a;r[n]?r[n].bindings.push(s):r[n]={render:function(){var e=0,t=i.replace(attributeReplace,function(){return contentText(a.bindings[e++].value)});return t},bindings:[s],batchNum:undefined},a=r[n],o.splice(1,0,s.value),setAttr(e,n,o.join("")),u(e)}),"__!!__"},pending:function(){if(pendingHookups.length){var e=pendingHookups.slice(0);return pendingHookups=[],can.view.hook(function(t){can.each(e,function(e){e(t)})})}return""}});var tokenReg=new RegExp("("+["<%%","%%>","<%==","<%=","<%#","<%","%>","<",">",'"',"'"].join("|")+")","g"),startTxt="var ___v1ew = [];",finishTxt="return ___v1ew.join('')",put_cmd="___v1ew.push(",insert_cmd=put_cmd,htmlTag=null,quote=null,beforeQuote=null,status=function(){return quote?"'"+beforeQuote.match(attrReg)[1]+"'":htmlTag?1:0},pendingHookups=[],scan=function(e,t){var n=[],r=0;e=e.replace(newLine,"\n"),e.replace(tokenReg,function(t,i,s){s>r&&n.push(e.substring(r,s)),n.push(i),r=s+i.length}),r<e.length&&n.push(e.substr(r));var i="",s=[startTxt],o=function(e,t){s.push(put_cmd,'"',clean(e),'"'+(t||"")+");")},u=[],a,f=null,l=!1,c="",h=[],p,d=0,v;htmlTag=quote=beforeQuote=null;for(;(v=n[d++])!==undefined;){if(f===null)switch(v){case"<%":case"<%=":case"<%==":l=1;case"<%#":f=v,i.length&&o(i),i="";break;case"<%%":i+="<%";break;case"<":n[d].indexOf("!--")!==0&&(htmlTag=1,l=0),i+=v;break;case">":htmlTag=0,l?(o(i,',can.EJS.pending(),">"'),i=""):i+=v,a.substr(-1)=="/"&&(h.pop(),c=h[h.length-1]);break;case"'":case'"':htmlTag&&(quote&&quote===v?quote=null:quote===null&&(quote=v,beforeQuote=a));default:a==="<"&&(c=v.split(" ")[0],c.indexOf("/")===0&&h.pop()===c.substr(1)?c=h[h.length-1]||c.substr(1):h.push(c)),i+=v}else switch(v){case"%>":switch(f){case"<%":p=bracketNum(i);if(p==1)s.push(insert_cmd,"can.EJS.txt(0,'"+c+"',"+status()+",this,function(){",startTxt,i),u.push({before:"",after:finishTxt+"}));\n"});else{var r=u.length&&p==-1?u.pop():{after:";"};r.before&&s.push(r.before),s.push(i,";",r.after)}break;case"<%=":case"<%==":p=bracketNum(i),p&&u.push({before:finishTxt,after:"}));"});if(quickFunc.test(i)){var m=i.match(quickFunc);i="function(__){var "+m[1]+"=can.$(__);"+m[2]+"}"}s.push(insert_cmd,"can.EJS.txt("+(f==="<%="?1:0)+",'"+c+"',"+status()+",this,function(){ return ",i,p?startTxt:"}));")}f=null,i="";break;case"<%%":i+="<%";break;default:i+=v}a=v}i.length&&o(i),s.push(";");var g=s.join(""),y={out:"with(_VIEW) { with (_CONTEXT) {"+g+" "+finishTxt+"}}"};return myEval.call(y,"this.fn = (function(_CONTEXT,_VIEW){"+y.out+"});\r\n//@ sourceURL="+t+".js"),y};EJS.Helpers=function(e,t){this._data=e,this._extras=t,extend(this,t)},EJS.Helpers.prototype={list:function(e,t){can.each(e,function(n,r){t(n,r,e)})}},can.view.register({suffix:"ejs",script:function(e,t){return"can.EJS(function(_CONTEXT,_VIEW) { "+(new EJS({text:t,name:e})).template.out+" })"},renderer:function(e,t){return EJS({text:t,name:e})}}),typeof define=="function"&&define.amd?define(["jquery"],function(){return can}):window.can=can})(can={},this)